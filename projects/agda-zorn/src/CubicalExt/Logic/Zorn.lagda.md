---
title: Agdaä½æ©å¼•ç†
---

# Agdaä½æ©å¼•ç†

## å‰è¨€

ä½æ©å¼•ç†æ˜¯ç»å…¸æ•°å­¦ä¸­æœ€åŸºç¡€çš„å®šç†ä¹‹ä¸€. ç„¶è€Œ, ä½œä¸ºç›´è§‰ä¸»ä¹‰æ•°å­¦çš„å‰æ²¿ä¹‹ä¸€, åŒä¼¦ç±»å‹è®º (HoTT) åœ¨ç»å…¸é¢†åŸŸçš„æ‰©å±•å¹¶æœªè·å¾—å¤ªå¤šç ”ç©¶å…³æ³¨. æœ¬æ–‡æ—¨åœ¨å¡«è¡¥è¿™ä¸€ç©ºç™½, æˆ‘ä»¬å°†åœ¨åŒä¼¦ç±»å‹è®ºçš„æ¡†æ¶ä¸‹å±•ç¤ºå¯¹ä½æ©å¼•ç†è¿™ä¸€ç»å…¸å®šç†çš„è¯æ˜. å°½ç®¡æœ¬æ–‡çš„å†…å®¹å¯ä»¥è¢«è§†ä¸º Agda ä»£ç çš„æ³¨é‡Š, æˆ‘ä»¬ä»ç„¶åŠ›æ±‚ä½¿å…¶å†…å®¹å¯¹äºä¸ç†Ÿæ‚‰ Agda è¯­è¨€çš„è¯»è€…ä¹Ÿèƒ½ç†è§£å…¶ä¸­çš„ä¸»è¦æ€è·¯, ä½†å‰ææ˜¯è¯»è€…éœ€è¦äº†è§£åŒä¼¦ç±»å‹è®ºçš„åŸºæœ¬æ¦‚å¿µ. ä¾‹å¦‚æˆ‘ä»¬ä¼šæ¶‰åŠåˆ° **å‘½é¢˜æˆªæ–­ (propositional truncation)** å’Œ **å‘½é¢˜å®‡å®™è°ƒæ•´** (propositional resizing) ç­‰æ¦‚å¿µ, éœ€è¦è¯»è€…å¯¹å®ƒä»¬æœ‰ä¸€äº›åŸºæœ¬äº†è§£.

æˆ‘ä»¬å·¥ä½œåœ¨æ— å…¬ç†çš„ cubical ç¯å¢ƒä¸­, è€Œé€‰æ‹©å…¬ç†å°†ä½œä¸ºå‚æ•°å¼•å…¥. è¿™é‡Œè¯´çš„ cubical æŒ‡ç«‹æ–¹ç±»å‹è®º (cubical type theory), å®ƒæ˜¯åŒä¼¦ç±»å‹è®ºçš„ä¸€ç§å®ç°.

```agda
{-# OPTIONS --cubical --safe #-}
{-# OPTIONS --lossy-unification #-}

module CubicalExt.Logic.Zorn where
```

é¦–å…ˆ, æˆ‘ä»¬éœ€è¦å¯¼å…¥ Cubical æ ‡å‡†åº“æ¨¡å—. åŒä¼¦ç±»å‹è®º (ä¹ƒè‡³å…¶ç«‹æ–¹ç±»å‹è®ºå®ç°) ä»¥å…¶å¯¹"ç›¸ç­‰"è¿™ä¸€åŸºç¡€æ¦‚å¿µçš„å¤æ‚è¯ é‡Šè€Œå¹¿ä¸ºäººçŸ¥. åœ¨æŸäº›æƒ…å†µä¸‹ (å¦‚å•é›†çš„å®šä¹‰ä¸­), æˆ‘ä»¬å°†ä½¿ç”¨ç«‹æ–¹ç±»å‹è®ºçš„ `Id` ç±»å‹, å› å…¶å¯ä»¥ä¾¿æ·åœ°è¿›è¡Œæ¨¡å¼åŒ¹é…. ç„¶è€Œ, åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹, æˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨è·¯å¾„ `Path` ç±»å‹.

```agda
open import Cubical.Core.Id using (reflId)
open import Cubical.Foundations.Prelude hiding (_âˆ§_; _âˆ¨_)
open import Cubical.Foundations.HLevels
open import Cubical.Foundations.Isomorphism using (Iso)
open import Cubical.Data.Empty as âŠ¥ using (âŠ¥; isPropâŠ¥)
open import Cubical.Data.Sigma using (âˆƒ-syntax; Î£PathP; PathPÎ£)
import Cubical.Data.Sum as âŠ
open import Cubical.HITs.PropositionalTruncation using (âˆ¥_âˆ¥â‚; âˆ£_âˆ£â‚; squashâ‚; rec; rec2; map)
open import Cubical.Relation.Nullary using (Â¬_; Dec; yes; no)
open import Cubical.Relation.Binary
open BinaryRelation
```

ä»¥ä¸‹æ˜¯æˆ‘ä»¬æŒ‰ç…§æ ‡å‡†åº“é£æ ¼é¢å¤–ç¼–å†™çš„å‰ç½®æ¨¡å—. è¿™äº›æ¨¡å—ä¸»è¦æ¶‰åŠç»å…¸é€»è¾‘å’Œé›†åˆè®ºçš„åŸºæœ¬æ¦‚å¿µ. æˆ‘ä»¬é¢„è®¾è¯»è€…å¯¹è¿™äº›æ¦‚å¿µæœ‰æ·±å…¥çš„ç†è§£, å› æ­¤ä¸ä¼šå†é€ä¸€è¿›è¡Œè§£é‡Š.

```agda
open import CubicalExt.Axiom.Choice
open import CubicalExt.Axiom.ExcludedMiddle
open import CubicalExt.Foundations.Powerset* hiding (U)
open import CubicalExt.Foundations.Function using (_âˆ˜_; _$_; it)
open import CubicalExt.Functions.Logic using (âˆ¥_âˆ¥â‚š; _âˆ§_; _âˆ¨_; inl; inr; âˆ¨-elimË¡; âˆ¨-elimÊ³)
```

å¦‚æœåœ¨åç»­çš„å†…å®¹ä¸­å‡ºç°äº†ä»¥ä¸‹åˆ—å‡ºçš„å˜é‡, ä½†æ²¡æœ‰æå‰è¿›è¡Œå£°æ˜, è¯·ç†è§£ä¸ºå®ƒä»¬å·²ä½œä¸ºéšå¼å‚æ•°è¢«å¼•å…¥ï¼Œå¹¶å…·å¤‡ä»¥ä¸‹è§„å®šçš„ç±»å‹.

```agda
private variable
  â„“ u r : Level
  U : Type â„“
  A : ğ’« U â„“
```

å…¶ä¸­ `Level` æ˜¯å®‡å®™ç­‰çº§, `ğ’« U â„“` è¡¨ç¤º `U` çš„ä½äº `â„“` å®‡å®™çš„å¹‚é›†. åœ¨åæ–‡ä¸­æˆ‘ä»¬å°†å‡è®¾æ’ä¸­å¾‹, è¿™å°†å¯¼è‡´å‘½é¢˜å®‡å®™åå¡Œåˆ°ä¸€å±‚. ä»è€Œå¹‚é›†å°†ä¸å†æœ‰å®‡å®™ç­‰çº§çš„åŒºåˆ†, ä½¿å…¶æ›´æ¥è¿‘äºä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å¹‚é›†.

## åºç†è®º

ä½æ©å¼•ç†çš„è¡¨è¿°éœ€è¦åºç†è®ºçš„åŸºæœ¬æ¦‚å¿µ. æˆ‘ä»¬å°†åœ¨æœ¬èŠ‚ä¸­å¯¹è¿™äº›æ¦‚å¿µè¿›è¡Œç®€è¦çš„å›é¡¾. ç»™å®šç±»å‹ `U` åŠå…¶ä¸Šçš„äºŒå…ƒå…³ç³» `R`.

```agda
module Order {U : Type u} (R : Rel U U r) where
```

### ååº

å¦‚æœ `R` å–å€¼åˆ°å‘½é¢˜, å¹¶ä¸”æ»¡è¶³è‡ªå, åå¯¹ç§°å’Œä¼ é€’æ€§, åˆ™ç§° `R` æ˜¯ååº (partial order).

```agda
  isPo : Type _
  isPo = isPropValued R âˆ§ isRefl R âˆ§ isAntisym R âˆ§ isTrans R
```

å¦‚æœ `R` æ˜¯ååºä¸” `U` æ˜¯é›†åˆ, åˆ™ç§° `U` ä¸ºååºé›†.

```agda
  isPoset : Type _
  isPoset = isSet U âˆ§ isPo
```

### æ— ç•Œ

æˆ‘ä»¬åˆç”¨ä¸­ç¼€ç¬¦å· `â‰¤` è¡¨ç¤º `R` å…³ç³».

```agda
  private _â‰¤_ = R
```

æˆ‘ä»¬è¯´ `U` åœ¨ `R` å…³ç³»ä¸‹æ˜¯æ— ç•Œçš„, å½“ä¸”ä»…å½“ä»ä»»æ„ `x : U` éƒ½èƒ½å¾—åˆ°ä¸€ä¸ª `y : U` ä¸¥æ ¼å¤§äº `x`.

```agda
  unbound : Type _
  unbound = âˆ€ x â†’ Î£[ y âˆˆ U ] x â‰¤ y âˆ§ Â¬ x â‰¡ y
```

æˆ‘ä»¬è¯´ `U` åœ¨ `R` å…³ç³»ä¸‹æ˜¯åç»§çš„, å½“ä¸”ä»…å½“å®ƒæ˜¯æ— ç•Œçš„, ä¸”è§è¯æ— ç•Œçš„é‚£ä¸ª `y` åˆšå¥½æ¯” `x` å¤§, ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¹‹é—´æ²¡æœ‰å…¶ä»–å…ƒç´ .

```agda
  successive : Type _
  successive = âˆ€ x â†’ Î£[ y âˆˆ U ] x â‰¤ y âˆ§ (Â¬ x â‰¡ y) âˆ§ âˆ€ z â†’ x â‰¤ z â†’ z â‰¤ y â†’ z â‰¡ x âˆ¨ z â‰¡ y
```

### æœ€å¤§å…ƒ

å¯¹ä»»æ„å¤§äºç­‰äº `m` çš„å…ƒç´ , å¦‚æœå®ƒå…¶å®éƒ½ç­‰äº `m`, é‚£ä¹ˆç§° `m` æ˜¯ `U` çš„æœ€å¤§å…ƒ.

```agda
  maximum : U â†’ Type _
  maximum m = âˆ€ x â†’ m â‰¤ x â†’ m â‰¡ x
```

æ³¨æ„æ— ç•Œä¸å­˜åœ¨æœ€å¤§å…ƒæ˜¯ä¸ç›¸å®¹çš„.

### é“¾

ç°åœ¨, è€ƒè™‘ `U` çš„å­é›† `A`, å¦‚æœå…¶ä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ éƒ½å¯ä»¥æ¯”è¾ƒå¤§å°, æˆ‘ä»¬å°±è¯´ `A` æ˜¯é“¾, ä¹Ÿå« `U` çš„å…¨åºå­é›†.

```agda
  isChain : ğ’« U â„“ â†’ Type _
  isChain A = âˆ€ x y â†’ x âˆˆ A â†’ y âˆˆ A â†’ x â‰¤ y âˆ¨ y â‰¤ x
```

æ³¨æ„ `âˆ¨` æ˜¯å’Œç±»å‹ `âŠ` çš„å‘½é¢˜æˆªæ–­, ä»è€Œä¿è¯äº†"æŸæŸæ˜¯é“¾"æ˜¯ä¸€ä¸ªå‘½é¢˜. åé¢è¦ç”¨åˆ°è¿™ä¸€æ€§è´¨.

```agda
  isPropIsChain : isProp (isChain A)
  isPropIsChain = isPropÎ 2 Î» _ _ â†’ isPropÎ 2 Î» _ _ â†’ squashâ‚
```

### ä¸Šç•Œ

ç»™å®š `A` å’Œ `ub : U`, å¦‚æœ `ub` æ¯” `A` çš„ä»»æ„å…ƒç´ éƒ½è¦å¤§, åˆ™ç§° `ub` æ˜¯ `A` çš„ä¸Šç•Œ. æ³¨æ„ä¸Šç•Œä¸ä¸€å®šåœ¨ `A` ä¸­.

```agda
  upperBound : ğ’« U â„“ â†’ U â†’ Type _
  upperBound A ub = âˆ€ x â†’ x âˆˆ A â†’ x â‰¤ ub
```

ç”±ä»¥ä¸Šå®šä¹‰, "æ‰€æœ‰é“¾éƒ½å¯ä»¥æ‰¾åˆ°ä¸Šç•Œ"è¡¨è¿°å¦‚ä¸‹.

```agda
  allChainHasUb = âˆ€ {â„“} (A : ğ’« U â„“) â†’ isChain A â†’ Î£[ ub âˆˆ U ] upperBound A ub
```

### ä¸Šç¡®ç•Œ

ç»™å®š `A` å’Œ `sup : U`, å¦‚æœ `sup` æ˜¯ `A` çš„æœ€å°ä¸Šç•Œ, åˆ™ç§° `sup` æ˜¯ `A` çš„ä¸Šç¡®ç•Œ. æ³¨æ„ä¸Šç¡®ç•Œä¹Ÿä¸ä¸€å®šåœ¨ `A` ä¸­.

```agda
  supremum : ğ’« U â„“ â†’ U â†’ Type _
  supremum A sup = upperBound A sup âˆ§ âˆ€ ub â†’ upperBound A ub â†’ sup â‰¤ ub
```

ç”±ä»¥ä¸Šå®šä¹‰, "æ‰€æœ‰é“¾éƒ½å¯ä»¥æ‰¾åˆ°ä¸Šç¡®ç•Œ"è¡¨è¿°å¦‚ä¸‹.

```agda
  allChainHasSup = âˆ€ {â„“} (A : ğ’« U â„“) â†’ isChain A â†’ Î£[ sup âˆˆ U ] supremum A sup
```

### ä½æ©å¼•ç†çš„è¡¨è¿°

ç»è¿‡ä»¥ä¸Šçš„æ¦‚å¿µé“ºå«, æˆ‘ä»¬ç°åœ¨å¯ä»¥æ­£å¼é˜è¿°ä½æ©å¼•ç†. ä½æ©å¼•ç†æ˜¯è¯´: å¯¹ä»»æ„ååºé›† `U`, å¦‚æœ `U` ä¸­æ‰€æœ‰çš„é“¾éƒ½èƒ½**æ‰¾åˆ°**ä¸Šç•Œ, é‚£ä¹ˆ `U` ä¸­**å­˜åœ¨**ä¸€ä¸ªæœ€å¤§å…ƒ.

```agda
  Zorn = isPoset â†’ allChainHasUb â†’ âˆƒ[ m âˆˆ U ] maximum m
```

éœ€è¦æ³¨æ„çš„æ˜¯, æˆ‘ä»¬ä»…å°† `Î£` çš„å‘½é¢˜æˆªæ–­ `âˆƒ` ç§°ä¸º*å­˜åœ¨*, è€Œå¯¹äº `Î£`, æˆ‘ä»¬ä¼šç”¨è¯¸å¦‚*æ‰¾åˆ°*, *å–åˆ°*, *å¾—åˆ°*ç­‰è¡¨è¿°. "å­˜åœ¨"ä¸ä¸€å®šèƒ½"å–åˆ°", ä½†èƒ½"å–åˆ°"åˆ™ä¸€å®š"å­˜åœ¨". æˆ‘ä»¬å°½é‡é¿å…ä½¿ç”¨ *æœ‰* è¿™ç§æ¨¡ç³Šçš„è¯´æ³•.

å½“ç„¶, ä½æ©å¼•ç†çš„è¡¨è¿°å¯ä»¥è¿›ä¸€æ­¥å¼ºåŒ–ä¸º"å¯¹ä»»æ„ååºé›† `U`, å¦‚æœ `U` ä¸­æ‰€æœ‰çš„é“¾éƒ½**å­˜åœ¨**ä¸Šç¡®ç•Œ, é‚£ä¹ˆ `U` ä¸­**å­˜åœ¨**ä¸€ä¸ªæœ€å¤§å…ƒ". åªéœ€è¦ç”¨å‘½é¢˜æˆªæ–­çš„ `rec`, å°±å¯ä»¥è¯æ˜å‰è€…è•´å«åè€…. ç„¶è€Œ, æˆ‘ä»¬ä¹ æƒ¯é¿å…åœ¨å‰æä¸­ä½¿ç”¨æˆªæ–­, ç­‰åˆ°éœ€è¦æ—¶å†ç”¨ `rec` å¾—åˆ°æˆªæ–­ç‰ˆæœ¬.

ä½æ©å¼•ç†çš„è¯æ˜æ€è·¯ä¸­åç›´è§‰çš„åœ°æ–¹æ˜¯æˆ‘ä»¬å¹¶éç›´æ¥è€ƒè™‘é“¾æœ¬èº«, è€Œæ˜¯è€ƒè™‘ç”±æ‰€æœ‰é“¾æ„æˆçš„é›†åˆåœ¨åŒ…å«å…³ç³»ä¸‹æ„æˆçš„é“¾.

## é“¾é›†çš„é“¾

ç°åœ¨, å‡è®¾æ’ä¸­å¾‹, å¹¶ç»™å®šååº `â‰¤`.

```agda
module Chain â¦ƒ em : âˆ€ {â„“} â†’ EM â„“ â¦„ {U : Type u} (_â‰¤_ : Rel U U r) where
  open import CubicalExt.Logic.Classical
  open module â‰¤ = Order _â‰¤_
```

æˆ‘ä»¬æŠŠ `U` çš„å­é›† `A` é…å¤‡ä¸Šé“¾æ¡ä»¶æ‰€å¾—åˆ°çš„ç±»å‹ `Chain` å«åšé“¾é›†.

```agda
  Chain : Type _
  Chain = Î£[ A âˆˆ ğ’« U â„“-zero ] â‰¤.isChain A
```

å¯ä»¥è¯æ˜ `Chain` æ˜¯é›†åˆ.

```agda
  _ : isSet Chain
  _ = isSetÎ£ (isSetÎ  Î» _ â†’ isSetHProp) Î» _ â†’ isPropâ†’isSet isPropIsChain
```

### ååº

å®šä¹‰é“¾é›†ä¸Šçš„äºŒå…ƒå…³ç³» `âª¯` ä¸ºé“¾ä¹‹é—´çš„åŒ…å«å…³ç³».

```agda
  _âª¯_ : Rel Chain Chain u
  a âª¯ b = a .fst âŠ† b .fst
```

ç”±äºé›†åˆçš„åŒ…å«å…³ç³»æ˜¯ååº, æ‰€ä»¥ `âª¯` ä¹Ÿæ˜¯ååº.

```agda
  âª¯-prop : isPropValued _âª¯_
  âª¯-prop _ _ = âŠ†-isProp _ _

  âª¯-refl : isRefl _âª¯_
  âª¯-refl = âŠ†-refl âˆ˜ fst

  âª¯-antisym : isAntisym _âª¯_
  âª¯-antisym _ _ Hâ‚ Hâ‚‚ = Î£PathP $ âŠ†-antisym _ _ Hâ‚ Hâ‚‚ , toPathP (â‰¤.isPropIsChain _ _)

  âª¯-trans : isTrans _âª¯_
  âª¯-trans _ _ _ Hâ‚ Hâ‚‚ xâˆˆ = Hâ‚‚ $ Hâ‚ xâˆˆ

  open module âª¯ = Order _âª¯_

  âª¯-po : âª¯.isPo
  âª¯-po = âª¯-prop , âª¯-refl , âª¯-antisym , âª¯-trans
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªååº, ä¸€ä¸ªæ˜¯ `U` ä¸Šçš„ `â‰¤`, ä¸€ä¸ªæ˜¯é“¾é›†ä¸Šçš„ `âª¯`. ä¸ºé¿å…æ··æ·†, æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå¯¹ç›¸å…³æ¦‚å¿µåŠ ä¸Š `â‰¤` æˆ– `âª¯` å‰ç¼€, æ¥æŒ‡æ˜è¯¥æ¦‚å¿µæ‰€æ¶‰åŠçš„ååº.

### ä¸Šç¡®ç•Œ

ç°åœ¨è€ƒè™‘é“¾é›†çš„é“¾. æ³¨æ„, å°½ç®¡é“¾é›†ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ â‰¤-é“¾, ä½†è¿™é‡Œæˆ‘ä»¬è¯´çš„æ˜¯ç”±é“¾é›†ä¸­çš„å…ƒç´ ç»„æˆçš„ âª¯-é“¾.

å¯¹ä»»æ„ âª¯-é“¾ `A`, æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å…¶ä¸Šç¡®ç•Œ, åªéœ€å– `A` ä¸­æ‰€æœ‰ â‰¤-é“¾çš„"å¹¶". ä¹Ÿå°±æ˜¯è¯´, å¹¶ä½œä¸ºä¸€ä¸ªé›†åˆ, å…¶ä¸­çš„ä»»æ„ `x`, éƒ½éœ€è¦å­˜åœ¨ä¸€æ¡ â‰¤-é“¾ `aâ‚` å®¹çº³å®ƒ, ä¸” `aâ‚` ä½œä¸ºé“¾é›†çš„ä¸€ä¸ªå…ƒç´  `a`, å¿…é¡»åœ¨ `A` ä¸­.

éœ€è¦æ³¨æ„çš„æ˜¯, `Chain` çš„å®šä¹‰ä»…æ¥å— `U` çš„ä½äºæœ€ä½å®‡å®™çš„å­é›†, ä¸ºäº†ä½¿æˆ‘ä»¬è¿™é‡Œå®šä¹‰çš„å¹¶ç¡®å®å…·æœ‰ `Chain` ç±»å‹, éœ€è¦å°†ä¸Šè¿°"å¹¶"**è°ƒæ•´** (`Resize`) åˆ°æœ€ä½å®‡å®™. ç”±äºæˆ‘ä»¬å‡è®¾äº†æ’ä¸­å¾‹, è¿™æ˜¯å¯ä»¥åšåˆ°çš„. å…³äºå…·ä½“çš„æ–¹æ³•, è¯»è€…å¯ä»¥ç‚¹å‡»ä»£ç ä¸­çš„ `Resize` æŸ¥çœ‹å…¶å®šä¹‰.

å…³äº**å‘½é¢˜å®‡å®™è°ƒæ•´** (propositional resizing), ä»¥ä¸‹æ‘˜è‡ª GPT4:

> åœ¨ç±»å‹è®ºä¸­ï¼Œpropositional resizing æ˜¯ä¸€ä¸ªå¤æ‚çš„æ¦‚å¿µï¼Œæ¶‰åŠåˆ°å¦‚ä½•å¤„ç†å‘½é¢˜çš„â€œå¤§å°â€ã€‚è¿™ä¸»è¦åœ¨åŒä¼¦ç±»å‹è®ºï¼ˆHomotopy Type Theory, HoTTï¼‰ä¸­å‡ºç°ã€‚åœ¨ç±»å‹è®ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‘½é¢˜çœ‹ä½œç±»å‹ï¼Œè¯æ˜çœ‹ä½œè¿™äº›ç±»å‹çš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œä¸åŒçš„å‘½é¢˜å¯èƒ½å¯¹åº”ä¸åŒ"å¤§å°"çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå­˜åœ¨æ€§å‘½é¢˜å¯èƒ½éœ€è¦ä¸€ä¸ªå¤§çš„ç±»å‹ï¼ˆæ¯”å¦‚ï¼Œæ‰€æœ‰çš„è‡ªç„¶æ•°ï¼‰ï¼Œè€Œå…¶ä»–å‘½é¢˜å¯èƒ½åªéœ€è¦ä¸€ä¸ªå°çš„ç±»å‹ï¼ˆæ¯”å¦‚ï¼ŒçœŸæˆ–å‡ï¼‰ã€‚propositional resizing å°±æ˜¯å…è®¸æˆ‘ä»¬åœ¨ä¸æ”¹å˜å‘½é¢˜çš„é€»è¾‘å«ä¹‰çš„æƒ…å†µä¸‹ï¼Œæ”¹å˜å®ƒæ‰€å¯¹åº”çš„ç±»å‹çš„å¤§å°ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå‘½é¢˜ P å¯¹åº”çš„ç±»å‹åœ¨ä¸€ä¸ªå¤§çš„ç±»å‹ä¸­ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›åœ¨ä¸€ä¸ªå°çš„ç±»å‹ä¸­ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ propositional resizing æ¥â€œç¼©å°â€å®ƒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œpropositional resizing èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´çµæ´»åœ°å¤„ç†å‘½é¢˜å’Œè¯æ˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é‚£äº›æ¶‰åŠåˆ°æ— ç©·é›†åˆçš„é—®é¢˜æ—¶ã€‚

```agda
  sup : (A : ğ’« Chain â„“) â†’ âª¯.isChain A â†’ Chain
  sup A isChainA = Resize âˆ˜ (Î» x â†’ (âˆƒ[ a@(aâ‚ , _ ) âˆˆ Chain ] x âˆˆ aâ‚ âˆ§ a âˆˆ A) , squashâ‚) ,
```

ä¸ºäº†ä¿è¯"å¹¶"å…·æœ‰ `Chain` ç±»å‹, æˆ‘ä»¬è¿˜éœ€è¦è¯´æ˜å®ƒæ˜¯ä¸€ä¸ª â‰¤-é“¾. æ ¹æ®å®šä¹‰, "å¹¶"ä¸­çš„ä»»æ„å…ƒç´ éƒ½åœ¨æŸä¸ª â‰¤-é“¾ä¸­, ä¸”è¯¥ â‰¤-é“¾åˆåœ¨ `A` ä¸­. ç”±äº `A` æ˜¯ âª¯-é“¾, "å¹¶"ä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ éƒ½å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå…±åŒçš„ â‰¤-é“¾å®¹çº³å®ƒ, å› æ­¤å®ƒä»¬å¯ä»¥æ¯”è¾ƒå¤§å°, è¿™ä¹Ÿå°±è¯´æ˜äº†"å¹¶"åŒæ ·æ˜¯ â‰¤-é“¾.

```agda
    Î» x y xâˆˆ yâˆˆ â†’ rec2 squashâ‚
      (Î»{ (a , xâˆˆa , aâˆˆA) (b , yâˆˆb , bâˆˆA) â†’ rec squashâ‚
        (Î»{ (âŠ.inl aâª¯b) â†’ b .snd x y (aâª¯b xâˆˆa) yâˆˆb
          ; (âŠ.inr bâª¯a) â†’ a .snd x y xâˆˆa (bâª¯a yâˆˆb) })
        (isChainA a b aâˆˆA bâˆˆA)})
      (unresize xâˆˆ) (unresize yâˆˆ)
```

ä¸‹é¢çš„ä»£ç è¯æ˜ä¸Šé¢è¯´çš„"å¹¶"ç¡®å®æ˜¯ä¸Šç¡®ç•Œ. ç”±é›†åˆè®ºçŸ¥è¯†, é›†æ—çš„å¹¶æ˜¾ç„¶æ˜¯ âŠ†-åºçš„ä¸Šç¡®ç•Œ. è¿™é‡Œä¸å†èµ˜è¿°.

```agda
  suphood : (A : ğ’« Chain â„“) (isChainA : âª¯.isChain A) â†’ âª¯.supremum A (sup A isChainA)
  suphood A isChainA = (Î» { a aâˆˆA xâˆˆaâ‚ â†’ resize âˆ£ a , xâˆˆaâ‚ , aâˆˆA âˆ£â‚ }) ,
    Î» ub ubhood xâˆˆsup â†’ rec (âˆˆ-isProp (ub .fst) _)
      (Î»{ (a , xâˆˆaâ‚ , aâˆˆA) â†’ ubhood a aâˆˆA xâˆˆaâ‚ })
      (unresize xâˆˆsup)
```

è‡³æ­¤, æˆ‘ä»¬è¯æ˜äº†é“¾é›†ä¸­çš„ä»»æ„é“¾éƒ½èƒ½æ‰¾åˆ°ä¸Šç¡®ç•Œ.

```
  âª¯-allChainHasSup : âª¯.allChainHasSup
  âª¯-allChainHasSup A isChainA = sup A isChainA , suphood A isChainA
```

### åç»§æ€§

æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¯æ˜ä¸€ä¸ªå…³é”®çš„å¼•ç†. å®ƒçš„å‰ä¸¤ä¸ªå‰æä¸ä½æ©å¼•ç†ç›¸åŒ, ç¬¬ä¸‰ä¸ªå‰æåˆ™æ˜¯å¯¹ä½æ©å¼•ç†ç»“è®ºçš„å¦å®š, æˆ‘ä»¬å°†åœ¨æœ€åä¸€èŠ‚ä½¿ç”¨é€‰æ‹©å…¬ç†æ¥è¯æ˜è¿™ä¸€ç‚¹. æœ€å, æˆ‘ä»¬å°†é‡‡ç”¨åè¯æ³•æ¥è¯æ˜ä½æ©å¼•ç†, åªéœ€å°†ä¸‹é¢å¼•ç†çš„ç»“è®ºä¸ä¸Šä¸€å°èŠ‚æ‰€è¯æ˜çš„äº‹å®ç»“åˆèµ·æ¥æ‰¾åˆ°çŸ›ç›¾å³å¯.

å…ˆå›åˆ°è¯¥å¼•ç†çš„è¯æ˜, è¦æ‰¾åˆ°ç»™å®šçš„ `a : Chain` çš„åç»§. å…·ä½“åœ°, æœ‰äº”ä¸ªå­ç›®æ ‡: ç»™å‡ºåç»§ `a'`; è¯´æ˜å®ƒå°äºç­‰äº `a`; è¯´æ˜å®ƒä¸ç­‰äº `a`; è¯´æ˜ `a` ä¸ `a'` ä¹‹é—´æ²¡æœ‰å…¶ä»–å…ƒç´ .

```agda
  âª¯-successvie : â‰¤.isPoset â†’ â‰¤.allChainHasUb â†’ â‰¤.unbound â†’ âª¯.successive
  âª¯-successvie (Uset , â‰¤-po) hasUb unbnd a@(A , isChainA) = a' , resize âˆ˜ inl , aâ‰¢a' , noMid where
```

ç”±å‰æ, `â‰¤` è‡ªå, åå¯¹ç§°ä¸”ä¼ é€’.

```agda
    â‰¤-refl    = â‰¤-po .snd .fst
    â‰¤-antisym = â‰¤-po .snd .snd .fst
    â‰¤-trans   = â‰¤-po .snd .snd .snd
```

å°† `a` åˆ†è§£ä¸º `U` çš„å­é›† `A` ä»¥åŠå®ƒæ˜¯ â‰¤-é“¾çš„è¯æ® `isChainA`. ç”±äº `A` æ˜¯ â‰¤-é“¾, ç”±å‰æ, å®ƒæœ‰ä¸Šç•Œ `ub`. åˆ `U` â‰¤-æ— ç•Œ, æ‰€ä»¥æœ‰æ¯” `ub` æ›´å¤§çš„ `ub'`.

```agda
    ub        = hasUb A isChainA .fst
    ubhood    = hasUb A isChainA .snd
    ub'       = unbnd ub .fst
    ubâ‰¤       = unbnd ub .snd .fst
    ubâ‰¢       = unbnd ub .snd. snd
```

ç°åœ¨, å– `A` ä¸­å…ƒç´ ä¸ `ub` æ‰€ç»„æˆçš„é›†åˆ, è®°ä½œ `A â¨­ ub`, å‘½åä¸º `A'`, å¹¶è°ƒæ•´åˆ°æœ€ä½å®‡å®™. æ³¨æ„, è¿™é‡Œçš„ `â¨­` è¿ç®—è¦æ±‚å…¨é›† `U` æ˜¯é›†åˆ.

```agda
    open SetBased Uset using (_â¨­_)
    A' = Resize âˆ˜ (A â¨­ ub')
```

ç”±äº `ub'` æ¯” `A` ä¸­å…ƒç´ éƒ½å¤§, æ‰€ä»¥æŠŠå®ƒåŠ è¿› `A` åå¯ä»¥ä¸ `A` ä¸­æ‰€æœ‰å…ƒç´ æ¯”å‡ºå¤§å°, æ‰€ä»¥ `A'` ä¹Ÿæ˜¯ â‰¤-é“¾.

```agda
    isChainA' : â‰¤.isChain A'
    isChainA' x y xâˆˆ yâˆˆ = rec2 squashâ‚
      (Î»{ (âŠ.inl xâˆˆA)    (âŠ.inl yâˆˆA)    â†’ isChainA x y xâˆˆA yâˆˆA
        ; (âŠ.inl xâˆˆA)    (âŠ.inr reflId) â†’ inl $ â‰¤-trans x ub y (ubhood x xâˆˆA) ubâ‰¤
        ; (âŠ.inr reflId) (âŠ.inl yâˆˆA)    â†’ inr $ â‰¤-trans y ub x (ubhood y yâˆˆA) ubâ‰¤
        ; (âŠ.inr reflId) (âŠ.inr reflId) â†’ inl $ â‰¤-refl x })
      (unresize xâˆˆ) (unresize yâˆˆ)
```

`A'` é…å¤‡ä¸Šå®ƒæ˜¯ â‰¤-é“¾çš„è¯æ® `isChainA'` å¾—åˆ° `a' : Chain`. æˆ‘ä»¬å®£ç§° `a'` å°±æ˜¯æ‰€éœ€åç»§. æ˜¾ç„¶ `A âŠ† A'`, æ‰€ä»¥ `a âª¯ a'`.

```agda
    a' = A' , isChainA'
```

ç”±äº `ub'` æ¯” `A` ä¸­æ‰€æœ‰å…ƒç´ éƒ½å¤§, æ‰€ä»¥å®ƒä¸åœ¨ `A` ä¸­, æ‰€ä»¥ `A` ä¸ `A'` ä¸åŒ, è¿™å°±è¯´æ˜äº† `a` ä¸ `a'` ä¸åŒ.

```agda
    aâ‰¢a' : Â¬ a â‰¡ a'
    aâ‰¢a' eq = let eq = PathPÎ£ eq .fst in
      ubâ‰¢ $ â‰¤-antisym ub ub' ubâ‰¤ $ ubhood ub' $
      subst (ub' âˆˆ_) (sym eq) $ resize $ inr reflId
```

æœ€å, æˆ‘ä»¬è¦è¯´æ˜ `a` ä¸ `a'` ä¹‹é—´æ²¡æœ‰å…¶ä»–å…ƒç´ . ç»™å®š `b` åœ¨ `a` ä¸ `a'` ä¹‹é—´, æˆ‘ä»¬è¯´æ˜ `b` è¦ä¹ˆç­‰äº `a`, è¦ä¹ˆç­‰äº `a'`. å°† `b` åˆ†è§£ä¸º `U` çš„å­é›† `B` ä»¥åŠå®ƒæ˜¯ â‰¤-é“¾çš„è¯æ® `isChainB`. ç°åœ¨, ç”¨æ’ä¸­å¾‹è®¨è®º `ub'` æ˜¯å¦åœ¨ `B` ä¸­.

```agda
    noMid : âˆ€ b â†’ a âª¯ b â†’ b âª¯ a' â†’ b â‰¡ a âˆ¨ b â‰¡ a'
    noMid b@(B , isChainB) AâŠ†B BâŠ†A' with em â¦ƒ âˆˆ-isProp B ub' _ _ â¦„
```

- è‹¥ `ub' âˆˆ B`, æˆ‘ä»¬è¯ `b â‰¡ a'`, åªéœ€è¯ `B â‰¡ A'`, è‡³äºå®ƒä»¬çš„ `isChain` è¯æ®, ç”±äºæ˜¯å‘½é¢˜, å¿…ç„¶ç›¸ç­‰. æˆ‘ä»¬ç”¨ `âŠ†` çš„åè‡ªåæ€§è¯æ˜ `B â‰¡ A'`. å·²çŸ¥ `B âŠ† A'` æ˜¯å‰æ, åªéœ€è¯ `A' âŠ† B`. `A'` ä¸­çš„å…ƒç´ è¦ä¹ˆæ˜¯ `A` ä¸­çš„å…ƒç´ , è¦ä¹ˆæ˜¯ `ub'`, è€Œ `A âŠ† B`, `ub' âˆˆ B`, æ‰€ä»¥ `A' âŠ† B`.

```agda
    ... | yes ub'âˆˆB = inr $ Î£PathP $ âŠ†-antisym B A' BâŠ†A' A'âŠ†B , toPathP (â‰¤.isPropIsChain _ isChainA')
      where A'âŠ†B : A' âŠ† B
            A'âŠ†B xâˆˆA' = rec (âˆˆ-isProp B _)
              (Î»{ (âŠ.inl xâˆˆA)    â†’ AâŠ†B xâˆˆA
                ; (âŠ.inr reflId) â†’ ub'âˆˆB })
              (unresize xâˆˆA')
```

- è‹¥ `ub' âˆ‰ B`, æˆ‘ä»¬è¯ `b â‰¡ a`, åªéœ€è¯ `B â‰¡ A`. åŒæ ·ç”¨ `âŠ†` çš„åè‡ªåæ€§, å·²çŸ¥ `A âŠ† B` æ˜¯å‰æ, åªéœ€è¯ `B âŠ† A`. ç”±äº `B âŠ† A'`, `A'` åªæ¯” `A` å¤šäº†ä¸€ä¸ªå…ƒç´  `ub'`, è€Œ `ub' âˆ‰ B`, æ‰€ä»¥ `B âŠ† A`.

```agda
    ... | no  ub'âˆ‰B = inl $ Î£PathP $ âŠ†-antisym B A BâŠ†A AâŠ†B , toPathP (â‰¤.isPropIsChain _ isChainA)
      where BâŠ†A : B âŠ† A
            BâŠ†A xâˆˆB = rec (âˆˆ-isProp A _)
              (Î»{ (âŠ.inl xâˆˆA)    â†’ xâˆˆA
                ; (âŠ.inr reflId) â†’ âŠ¥.rec $ ub'âˆ‰B xâˆˆB })
              (unresize (BâŠ†A' xâˆˆB))
```

è‡³æ­¤, æˆ‘ä»¬è¯æ˜äº†æŸä¸ªåºåœ¨ä¸€å®šæ¡ä»¶ä¸‹åŒæ—¶æ»¡è¶³ "ä»»æ„é“¾éƒ½èƒ½å–ä¸Šç¡®ç•Œ" ä¸ "ä»»æ„å…ƒç´ éƒ½å–åç»§". æˆ‘ä»¬å°†è¯æ˜, è¿™å®é™…ä¸Šæ˜¯çŸ›ç›¾çš„.

## æ„é€ çŸ›ç›¾

å‡è®¾æ’ä¸­å¾‹, ç»™å®šååº `â‰¤`, å‡è®¾å…¶ä»»æ„é“¾éƒ½èƒ½å–ä¸Šç¡®ç•Œ, ä¸”ä»»æ„å…ƒç´ éƒ½å–åç»§.

```agda
module Contra â¦ƒ em : âˆ€ {â„“} â†’ EM â„“ â¦„ {U : Type u} {_â‰¤_ : Rel U U r}
  (â‰¤-po : Order.isPo _â‰¤_) (hasSup : Order.allChainHasSup _â‰¤_) (hasSuc : Order.successive _â‰¤_) where
  open import CubicalExt.Logic.Classical
  open Order _â‰¤_
```

ç”±å‰æ, `â‰¤` å–å€¼åˆ°å‘½é¢˜, è‡ªå, åå¯¹ç§°ä¸”ä¼ é€’.

```agda
  private
    â‰¤-prop    = â‰¤-po .fst
    â‰¤-refl    = â‰¤-po .snd .fst
    â‰¤-antisym = â‰¤-po .snd .snd .fst
    â‰¤-trans   = â‰¤-po .snd .snd .snd
    instance
      â‰¤-propImplicit : {x y : U} â†’ isPropImplicit (x â‰¤ y)
      â‰¤-propImplicit = â‰¤-prop _ _ _ _
```

### å½’çº³æ„é€ "å¡”"

æ¥ä¸‹æ¥çš„æ„é€ åœ¨é›†åˆè®ºä¸­ä¸€èˆ¬ç”¨åºæ•°ä¸Šçš„è¶…é™é€’å½’å®ç°, åœ¨ç±»å‹è®ºä¸­æˆ‘ä»¬ç”¨å½’çº³ç±»å‹. æˆ‘ä»¬å°†å®šä¹‰ `U` çš„ä¸€ä¸ªè°“è¯, å‘½åä¸º `Tower`. æˆ‘ä»¬ä¼šæŠŠå®ƒæˆªæ–­ä¸º `U` çš„å­é›†, å‘½åä¸º `TowerSetâ„“`, ç„¶åå†è°ƒæ•´åˆ°æœ€ä½å®‡å®™, å‘½åä¸º `TowerSet`.

```agda
  data Tower : U â†’ Type (â„“-max (â„“-suc â„“-zero) (â„“-max u r))
  TowerSetâ„“ : ğ’« U _
  TowerSetâ„“ x = âˆ¥ Tower x âˆ¥â‚š
  TowerSet : ğ’« U â„“-zero
  TowerSet = Resize âˆ˜ TowerSetâ„“
```

ç°åœ¨å½’çº³å®šä¹‰è°“è¯ `Tower`:

- å¯¹ä»»æ„ `x` æ»¡è¶³ `Tower`, `x` çš„åç»§ä¹Ÿæ»¡è¶³ `Tower`.
- å¯¹ä»»æ„ `U` çš„å­é›† `A`, å¦‚æœå®ƒåŒ…å«äº `TowerSetâ„“`, ä¸”æ˜¯é“¾, é‚£ä¹ˆå®ƒçš„ä¸Šç¡®ç•Œä¹Ÿæ»¡è¶³ `Tower`.

```agda
  data Tower where
    includeSuc : (x : U) â†’ Tower x â†’ Tower (hasSuc x .fst)
    includeSup : (A : ğ’« U â„“-zero) â†’ (A âŠ† TowerSetâ„“) â†’ (isChainA : isChain A) â†’
      Tower (hasSup A isChainA .fst)
```

æ³¨æ„ `TowerSetâ„“` åœ¨ `Tower` å®šä¹‰å®Œæˆä¹‹å‰å°±è¢«ä½¿ç”¨äº†. Agda å…è®¸è¿™ç§å†™æ³•, åªè¦æ»¡è¶³ä¸€å®šæ¡ä»¶, è¿™é‡Œä¸å±•å¼€.

### "å¡”"ä¹Ÿæ˜¯é“¾

æ¥ä¸‹æ¥, æˆ‘ä»¬å°†è¯æ˜ä»»æ„ä¸¤ä¸ªæ»¡è¶³ `Tower` çš„å…ƒç´ éƒ½å¯ä»¥æ¯”è¾ƒå¤§å°, å‘½åä¸º `isChainTower`. ä¸€æ—¦å…¶è¯æ˜å®Œæˆ, å°±å¯ä»¥ç«‹å³è¯æ˜ `TowerSetâ„“` æ˜¯é“¾, ä¹ƒè‡³ `TowerSet` æ˜¯é“¾.

```agda
  isChainTower : âˆ€ x y â†’ Tower x â†’ Tower y â†’ x â‰¤ y âˆ¨ y â‰¤ x
  isChainTowerSetâ„“ : isChain TowerSetâ„“
  isChainTowerSetâ„“ x y = rec2 squashâ‚ (isChainTower x y)
  isChainTowerSet : isChain TowerSet
  isChainTowerSet x y xâˆˆ yâˆˆ = isChainTowerSetâ„“ x y (unresize xâˆˆ) (unresize yâˆˆ)
```

è¯¥å‘½é¢˜çš„è¯æ˜éœ€è¦å¤æ‚çš„é€’å½’, ä¸ºäº†ä½¿ç»“æ„æ›´æ¸…æ™°, æˆ‘ä»¬å†™æˆäº’é€’å½’ (mutual recursion).

æˆ‘ä»¬å…ˆè¯æ˜ç»“è®ºçš„ä¸€ä¸ªå¼±åŒ–ç‰ˆ, ä½œä¸ºä¸­é—´å¼•ç†, å‘½åä¸º `almostChain`, å…¶è¯æ˜ä¼šé€’å½’è°ƒç”¨ `isChainTower`. éšå, æˆ‘ä»¬å®Œæˆ `isChainTower` çš„è¯æ˜, å…¶ä¸­ä¼šé€’å½’è°ƒç”¨ `almostChain`. Agda ä¼šä¿è¯å¾ªç¯è®ºè¯ä¸ä¼šé€šè¿‡.

ç°åœ¨, ç»™å®šæ»¡è¶³ `Tower` æ¡ä»¶çš„ `y`. å°† `y` çš„åç»§è®°ä½œ `y'`.

```agda
  module _ y (yâˆˆ : Tower y) where
    private y' = hasSuc y .fst
```

`almostChain` æ˜¯è¯´ä»»æ„æ»¡è¶³ `Tower` æ¡ä»¶çš„ `x` è¦ä¹ˆå°äºç­‰äº `y` è¦ä¹ˆå¤§äºç­‰äº `y'`.

```agda
    almostChain : âˆ€ x â†’ Tower x â†’ x â‰¤ y âˆ¨ y' â‰¤ x
```

è¿™é‡Œåˆéœ€è¦ä¸€ä¸ªäº’é€’å½’å‘½é¢˜ `almostChain'`: ä»»æ„å±äº `TowerSetâ„“` çš„ `x` è¦ä¹ˆå°äºç­‰äº `y` è¦ä¹ˆå¤§äºç­‰äº `y'`. å®ƒä¼šåœ¨åé¢ `almostChain` çš„è¯æ˜é‡Œè°ƒç”¨, ä½†æ˜¯æˆ‘ä»¬å…ˆè°ƒç”¨ `almostChain` æ¥è¯æ˜å®ƒ. è¿™ä¸ªè¯æ˜é€šè¿‡å¯¹é«˜é˜¶å½’çº³ç±»å‹ (HIT) è¿›è¡Œæ¨¡å¼åŒ¹é…å®Œæˆ, å…·ä½“çš„æŠ€æœ¯ç»†èŠ‚è¿™é‡Œä¸å±•å¼€.

```agda
    almostChain' : âˆ€ x â†’ x âˆˆ TowerSetâ„“ â†’ x â‰¤ y âˆ¨ y' â‰¤ x
    almostChain' x âˆ£ xâˆˆ âˆ£â‚ = almostChain x xâˆˆ
    almostChain' x (squashâ‚ xâˆˆâ‚ xâˆˆâ‚‚ i) = squashâ‚ (almostChain' x xâˆˆâ‚) (almostChain' x xâˆˆâ‚‚) i
```

å›åˆ° `almostChain` çš„è¯æ˜. ç”± `Tower` çš„å®šä¹‰, å‰æå½’çº³ä¸ºä¸¤ç§æƒ…å†µ.

- `x` (è¿™é‡Œé‡å‘½åä¸º `x'`) å…¶å®æ˜¯æŸä¸ªæ»¡è¶³ `Tower` çš„ `x` çš„åç»§. è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬é€’å½’è°ƒç”¨ `isChainTower` è®¨è®º `x'` ä¸ `y` çš„å¤§å°, å†é€’å½’è°ƒç”¨ `almostChain` è®¨è®º `x` ä¸ `y` çš„å¤§å°, åˆ†ä¸‰ç§æƒ…å†µ.

  + `x â‰¤ y` ä¸” `x' â‰¤ y`. å–ç›®æ ‡çš„å·¦è¾¹å³è¯.
  + `x â‰¤ y` ä¸” `y â‰¤ x'`. ç”±äº `x'` æ˜¯ `x` çš„åç»§, å®ƒä»¬ä¹‹é—´çš„ `y` è¦ä¹ˆç­‰äº `x`, è¿™æ—¶ç›®æ ‡çš„å³è¾¹ `x â‰¤ x'` æˆç«‹; è¦ä¹ˆ `y` ç­‰äº `x'`, è¿™æ—¶ç›®æ ‡çš„å·¦è¾¹ `x â‰¤ x'` æˆç«‹.
  + `y' â‰¤ x`. è¿™æ—¶ç”±ä¼ é€’æ€§æœ‰ `y' â‰¤ x'`, å³ç›®æ ‡å³è¾¹.

```agda
    almostChain x' (includeSuc x xâˆˆ) with isChainTower x' y (includeSuc x xâˆˆ) yâˆˆ
    ... | IH = rec2 squashâ‚
      (Î»{ (âŠ.inl xâ‰¤y) (âŠ.inl x'â‰¤y) â†’ inl x'â‰¤y
        ; (âŠ.inl xâ‰¤y) (âŠ.inr yâ‰¤x') â†’ rec squashâ‚
          (Î»{ (âŠ.inl yâ‰¡x)  â†’ inr $ subst (Î» x â†’ _ â‰¤ hasSuc x .fst) yâ‰¡x (â‰¤-refl _)
            ; (âŠ.inr yâ‰¡x') â†’ inl $ subst (Î» x â†’ _ â‰¤ x) (sym yâ‰¡x') (â‰¤-refl _) })
          (noMid y xâ‰¤y yâ‰¤x')
        ; (âŠ.inr y'â‰¤x) _ â†’ inr $ â‰¤-trans y' x x' y'â‰¤x xâ‰¤x' })
      (almostChain x xâˆˆ) IH where
      xâ‰¤x'  = hasSuc x .snd .fst
      noMid = hasSuc x .snd .snd .snd
```

- `x` å…¶å®æ˜¯ `TowerSetâ„“` çš„å­é›†: é“¾ `A` çš„ä¸Šç¡®ç•Œ. æˆ‘ä»¬ç”¨æ’ä¸­å¾‹è®¨è®º `y` æ˜¯ä¸æ˜¯ `A` çš„ä¸Šç•Œ.

  + `y` æ˜¯ `A` çš„ä¸Šç•Œ, é‚£ä¹ˆæœ‰ `x â‰¤ y`, ç›®æ ‡å·¦è¾¹æˆç«‹.
  + `y` ä¸æ˜¯ `A` çš„ä¸Šç•Œ, é‚£ä¹ˆæœ‰ `y` ä¸ `A` çš„ä¸Šç¡®ç•Œ `x` ä¹‹é—´å­˜åœ¨ (è¿™é‡Œä¹Ÿç”¨äº†æ’ä¸­å¾‹) ä¸€ä¸ªå…ƒç´  `z` æ»¡è¶³ `y < z` ä¸” `z â‰¤ x`. ç”±ä¼ é€’æ€§, `y' â‰¤ x`, å³ç›®æ ‡å³è¾¹æˆç«‹. æ³¨æ„è¿™é‡Œéœ€è¦è°ƒç”¨ `almostChain'` ä»¥ä½¿ç”¨ "`A` æ˜¯ `TowerSetâ„“` çš„å­é›†" è¿™ä¸€å‰æ.

```agda
    almostChain x (includeSup A AâŠ† isChainA) with em {P = upperBound A y}
    ... | yes p = inl $ hasSup A isChainA .snd .snd y p
    ... | no Â¬p = inr $ rec (â‰¤-prop _ _)
      (Î»{ (z , Â¬ub) â†’ let (zâˆˆA , Â¬zâ‰¤y) = Â¬â†’â†’âˆ§ (z âˆˆ A) â¦ƒ âˆˆ-isProp _ _ _ _ â¦„ (z â‰¤ y) Â¬ub in
        â‰¤-trans y' z x
          (âˆ¨-elimÊ³ (â‰¤-prop _ _) (almostChain' z (AâŠ† zâˆˆA)) Â¬zâ‰¤y)
          (hasSup A isChainA .snd .fst z zâˆˆA) })
      (Â¬âˆ€â†’âˆƒÂ¬ Â¬p)
```

è‡³æ­¤ `almostChain` è¯æ¯•. ä¸ `almostChain'` ç±»ä¼¼åœ°, æˆ‘ä»¬æ¨¡å¼åŒ¹é…é«˜é˜¶å½’çº³ç±»å‹å…ˆè¯æ˜äº† `isChainTower'`.

```agda
  isChainTower' : âˆ€ x y â†’ Tower x â†’ y âˆˆ TowerSetâ„“ â†’ x â‰¤ y âˆ¨ y â‰¤ x
  isChainTower' x y xâˆˆ âˆ£ yâˆˆ âˆ£â‚ = isChainTower x y xâˆˆ yâˆˆ
  isChainTower' x y xâˆˆ (squashâ‚ yâˆˆâ‚ yâˆˆâ‚‚ i) = squashâ‚ (isChainTower' x y xâˆˆ yâˆˆâ‚) (isChainTower' x y xâˆˆ yâˆˆâ‚‚) i
```

å›åˆ° `isChainTower` çš„è¯æ˜. ç”± `Tower` çš„å®šä¹‰, å‰æå½’çº³ä¸ºä¸¤ç§æƒ…å†µ.

- `y` (è¿™é‡Œé‡å‘½åä¸º `y'`) å…¶å®æ˜¯æŸä¸ªæ»¡è¶³ `Tower` çš„ `y` çš„åç»§. è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬é€’å½’è°ƒç”¨ `almostChain`. åˆ†ä¸¤ç§æƒ…å†µ.

  + `x â‰¤ y`. ç”±ä¼ é€’æ€§, `x â‰¤ y'`, å³ç›®æ ‡çš„å·¦è¾¹æˆç«‹.
  + `y' â‰¤ x`. ç›®æ ‡çš„å³è¾¹æˆç«‹.

```agda
  isChainTower x y' xâˆˆ (includeSuc y yâˆˆ) = rec squashâ‚
    (Î»{ (âŠ.inl xâ‰¤y)  â†’ inl (â‰¤-trans x y y' xâ‰¤y yâ‰¤y')
      ; (âŠ.inr y'â‰¤x) â†’ inr y'â‰¤x })
    (almostChain y yâˆˆ x xâˆˆ) where yâ‰¤y' = hasSuc y .snd .fst
```

- `y` å…¶å®æ˜¯ `TowerSetâ„“` çš„å­é›†: é“¾ `A` çš„ä¸Šç¡®ç•Œ. è¿™ç§æƒ…å†µä¸ `almostChain` çš„ç›¸åº”æƒ…å†µç›¸å½“ç±»ä¼¼, åªä¸è¿‡å˜é‡åå­—æ¢äº†ä¸€ä¸‹.

```agda
  isChainTower x y xâˆˆ (includeSup A AâŠ† isChainA) with em {P = upperBound A x}
  ... | yes p = inr $ hasSup A isChainA .snd .snd x p
  ... | no Â¬p = inl $ rec (â‰¤-prop _ _)
    (Î»{ (z , Â¬ub) â†’ let (zâˆˆA , Â¬zâ‰¤x) = Â¬â†’â†’âˆ§ (z âˆˆ A) â¦ƒ âˆˆ-isProp _ _ _ _ â¦„ (z â‰¤ x) Â¬ub in
      â‰¤-trans x z y
        (âˆ¨-elimË¡ (â‰¤-prop _ _) (isChainTower' x z xâˆˆ (AâŠ† zâˆˆA)) Â¬zâ‰¤x)
        (hasSup A isChainA .snd .fst z zâˆˆA) })
    (Â¬âˆ€â†’âˆƒÂ¬ Â¬p)
```

### çŸ›ç›¾

è¯æ˜äº† `TowerSet` æ˜¯é“¾ä¹‹å, æ„é€ çŸ›ç›¾å°±éå¸¸ç®€å•äº†. ç”±å‰æ, `TowerSet` å¯ä»¥å–åˆ°ä¸Šç¡®ç•Œ `sup`, ä¸” `sup` å¯ä»¥å–åˆ°åç»§ `suc`.

```agda
  Î£sup = hasSup TowerSet isChainTowerSet
  sup = Î£sup .fst
  ubhood = Î£sup .snd .fst

  Î£suc = hasSuc sup
  suc = Î£suc .fst
  supâ‰¤suc = Î£suc .snd .fst
  supâ‰¢suc = Î£suc .snd .snd .fst
```

æŒ‰ `Tower` çš„å®šä¹‰, `sup` ä¹Ÿæ»¡è¶³å®ƒ. è¿™é‡Œå‘½é¢˜å®‡å®™è°ƒæ•´ (propositional resizing) èµ·äº†å…³é”®ä½œç”¨.

```agda
  supâˆˆTower : Tower sup
  supâˆˆTower = includeSup TowerSet unresize isChainTowerSet
```

è¿™æ ·, æŒ‰ `TowerSet` çš„å®šä¹‰, `suc` ä¹Ÿåœ¨ `TowerSet` é‡Œ.

```agda
  sucâˆˆTowerSet : suc âˆˆ TowerSet
  sucâˆˆTowerSet = resize $ map (includeSuc sup) âˆ£ supâˆˆTower âˆ£â‚
```

ä½†æ˜¯ `suc` æ˜¯ `sup` çš„åç»§, ä¸ `sup` æ˜¯ `TowerSet` çš„ä¸Šç¡®ç•ŒçŸ›ç›¾.

```agda
  false : âŠ¥
  false = supâ‰¢suc $ â‰¤-antisym _ _ supâ‰¤suc sucâ‰¤sup where
    sucâ‰¤sup : suc â‰¤ sup
    sucâ‰¤sup = ubhood suc sucâˆˆTowerSet
```

## é€‰æ‹©å…¬ç†

æˆ‘ä»¬å°†å‡è®¾å¦‚ä¸‹å½¢å¼çš„é€‰æ‹©å…¬ç†:

> éç©ºé›†åˆçš„ç¬›å¡å°”ç§¯éç©º

åœ¨åŒä¼¦ç±»å‹è®ºä¸­è¡¨è¿°ä¸º :

`(âˆ€ x â†’ âˆ¥ B x âˆ¥â‚) â†’ âˆ¥ âˆ€ x â†’ B x âˆ¥â‚`

å…¶ä¸­ `x` å…·æœ‰ç±»å‹ `A`, è€Œ `A` å’Œæ¯ä¸ª `B x` éƒ½æ˜¯é›†åˆ.

## ä½æ©å¼•ç†çš„è¯æ˜

å‡è®¾é€‰æ‹©å…¬ç†, ç»™å®š `U` ä¸Šçš„äºŒå…ƒå…³ç³» `â‰¤`.

```agda
module _ (ac : âˆ€ {â„“ â„“'} â†’ AC â„“ â„“') {U : Type u} {_â‰¤_ : Rel U U r} where
  open import CubicalExt.Logic.ClassicalChoice ac
  open Order _â‰¤_
```

å‡è®¾ `U` æ˜¯ååºé›†, ä¸”ä¸å­˜åœ¨æœ€å¤§å…ƒ, æˆ‘ä»¬è¯æ˜ "`U` æ— ç•Œ" çš„å‘½é¢˜æˆªæ–­ `âˆ¥ unbound âˆ¥â‚` æˆç«‹. ä¸éš¾å‘ç°, ç›®æ ‡å…·æœ‰é€‚ç”¨äºé€‰æ‹©å…¬ç†çš„å½¢å¼. é€‰æ‹©å…¬ç†è¦æ±‚ `U` æ˜¯é›†åˆ, ä¸” `U` é…å¤‡ä¸Šæ— ç•Œæ¡ä»¶ä¹Ÿæ˜¯é›†åˆ, è¿™äº›æ˜¾ç„¶æˆç«‹. ç°åœ¨åªéœ€è¯å¯¹ä»»æ„ `x` **å­˜åœ¨** `y` ä¸¥æ ¼å¤§äºå®ƒ.

```agda
  noMaximumâ†’unbound : isPoset â†’ Â¬ (âˆƒ[ m âˆˆ U ] maximum m) â†’ âˆ¥ unbound âˆ¥â‚
  noMaximumâ†’unbound â‰¤-poset noMax = ac Uset Î£set H where
    Uset = â‰¤-poset .fst
    â‰¤-prop = â‰¤-poset .snd .fst
    Î£set : âˆ€ x â†’ isSet (Î£[ x' âˆˆ U ] (x â‰¤ x' âˆ§ Â¬ x â‰¡ x'))
    Î£set = Î» _ â†’ isSetÎ£ Uset Î» _ â†’ isPropâ†’isSet $ isPropÎ£ (â‰¤-prop _ _) Î» _ â†’ isPropÎ  Î» _ â†’ isPropâŠ¥
```

æ³¨æ„ `â‰¤` å’Œ `U` ä¸Šçš„ `â‰¡` éƒ½æ˜¯å‘½é¢˜. è¿™è¯´æ˜æ¥ä¸‹æ¥è¯æ˜æ¶‰åŠè¿™äº›å…³ç³»çš„ç›®æ ‡æ—¶ä½¿ç”¨æ’ä¸­å¾‹æ˜¯åˆæ³•çš„.

```agda
    instance
      â‰¤-propImplicit : {x y : U} â†’ isPropImplicit (x â‰¤ y)
      â‰¤-propImplicit = â‰¤-prop _ _ _ _
      â‰¡-propImplicit : {x y : U} â†’ isPropImplicit (x â‰¡ y)
      â‰¡-propImplicit = Uset _ _ _ _
```

ä¸å­˜åœ¨æœ€å¤§å…ƒè¯´æ˜å¯¹ä»»æ„ `x` å­˜åœ¨ `x'` æ»¡è¶³ `Â¬ (x â‰¤ x' â†’ x â‰¡ x')`. ç”¨æ’ä¸­å¾‹å°†è¿™éƒ¨åˆ†è½¬åŒ–æˆ `x â‰¤ x' âˆ§ Â¬ x â‰¡ x'` å°±è¯æ˜äº† `x'` ä¸¥æ ¼å¤§äº `x`.

```agda
    Hâ‚€ : âˆ€ x â†’ âˆƒ[ x' âˆˆ U ] Â¬ (x â‰¤ x' â†’ x â‰¡ x')
    Hâ‚€ x = Â¬âˆ€â†’âˆƒÂ¬ Î» H â†’ noMax âˆ£ x , H âˆ£â‚
    H : âˆ€ x â†’ âˆƒ[ x' âˆˆ U ] (x â‰¤ x' âˆ§ Â¬ x â‰¡ x')
    H x = rec squashâ‚ (Î» { (x' , H) â†’ âˆ£ x' , Â¬â†’â†’âˆ§ (x â‰¤ x') (x â‰¡ x') H âˆ£â‚ }) (Hâ‚€ x)
```

æœ€åä½æ©å¼•ç†çš„è¯æ˜å°±éå¸¸ç®€å•äº†. ç”¨åè¯æ³•, å‡è®¾ `U` æ²¡æœ‰æœ€å¤§å…ƒ, ç”±ä¸Šä¸€æ¡å¼•ç†æœ‰ `âˆ¥ unbound âˆ¥â‚`. è¿™æ—¶åªéœ€ `rec` åˆ° `âŠ¥`, æ‰€ä»¥å¯ä»¥å»æ‰æˆªæ–­, æ‹¿åˆ°å®Œæ•´çš„ `unbound`. è¿™æ­£å¥½æ˜¯ `âª¯-successvie` çš„å‰æ, äºæ˜¯æˆ‘ä»¬å¯ä»¥è¯æ˜é“¾é›†çš„ä»»æ„é“¾éƒ½èƒ½å–ä¸Šç•Œä¸”é“¾é›†æ˜¯åç»§çš„. ç”±"å¡”"çš„æ„é€ æˆ‘ä»¬çŸ¥é“è¿™æ˜¯çŸ›ç›¾çš„.

```agda
  zorn : Zorn
  zorn â‰¤-poset hasUb = byContra Î» noMax â†’ rec isPropâŠ¥
    (Contra.false âª¯-po âª¯-allChainHasSup âˆ˜ âª¯-successvie â‰¤-poset hasUb)
    (noMaximumâ†’unbound â‰¤-poset noMax)
    where open Chain _â‰¤_
```
